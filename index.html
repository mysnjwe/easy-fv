<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Easy FV - Prosty i Darmowy Generator Faktur Online</title>
    <meta name="description" content="Easy FV to prosty, darmowy program do tworzenia faktur online. Idealny dla freelancerów i małych firm. Twórz profesjonalne faktury szybko i łatwo!">
    <meta name="keywords" content="program do faktur, Easy FV, faktury online, darmowe faktury, generator faktur, faktury dla freelancerów, narzędzie do faktur">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #4FACFE;
            --primary-hover: #3d98e7;
            --primary-light: #E9F6FF;
            --background: #FFFFFF;
            --card-bg: #FFFFFF;
            --accent: #F2F7FF;
            --mint: #E0FFF8;
            --text: #2B3A55;
            --text-light: #8E9AAF;
            --border: #EDF2F7;
            --border-focus: #D0E3FF;
            --success: #67E8B4;
            --success-light: #E7FFF5;
            --warning: #FFD572;
            --danger: #FF7A87;
            --radius: 12px;
            --radius-sm: 8px;
            --shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.04);
            --shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            --shadow-lg: 0 10px 25px -5px rgba(0, 0, 0, 0.05);
            --transition: all 0.2s ease;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Roboto', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
        }

        body {
            color: var(--text);
            background-color: var(--background);
            line-height: 1.6;
            font-size: 0.95rem;
            font-weight: 400;
        }

        .container {
            width: 100%;
            max-width: 1280px;
            margin: 0 auto;
            padding: 0 2rem;
        }

        .login-container {
            max-width: 460px;
            margin: 5rem auto;
            background: var(--card-bg);
            padding: 3rem;
            border-radius: var(--radius);
            box-shadow: var(--shadow-lg);
        }

        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1.5rem 0;
            margin-bottom: 3rem;
        }

        .logo {
            font-weight: 600;
            font-size: 1.5rem;
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .logo-icon {
            background: linear-gradient(135deg, var(--primary) 0%, #00C6FB 100%);
            color: white;
            width: 36px;
            height: 36px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            letter-spacing: -1px;
            box-shadow: 0 4px 10px rgba(0, 198, 251, 0.2);
        }

        .nav {
            display: flex;
            gap: 1rem;
            align-items: center;
        }

        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 0.75rem;
            padding: 0.75rem 1.5rem;
            background-color: var(--primary);
            color: white;
            border: none;
            border-radius: var(--radius);
            cursor: pointer;
            font-size: 0.9375rem;
            font-weight: 500;
            text-decoration: none;
            transition: var(--transition);
            box-shadow: 0 4px 12px rgba(79, 172, 254, 0.2);
        }

        .btn:hover {
            background-color: var(--primary-hover);
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(79, 172, 254, 0.25);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn-secondary {
            background-color: var(--accent);
            color: var(--text);
            box-shadow: var(--shadow-sm);
        }

        .btn-secondary:hover {
            background-color: var(--primary-light);
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.03);
        }

        .btn-outline {
            background-color: transparent;
            color: var(--primary);
            border: 1px solid var(--border);
            box-shadow: none;
        }

        .btn-outline:hover {
            background-color: var(--primary-light);
            border-color: var(--primary);
            box-shadow: none;
        }

        .form-group {
            margin-bottom: 1.75rem;
        }

        label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            font-size: 0.9rem;
            color: var(--text);
        }

        input, select, textarea {
            width: 100%;
            padding: 0.875rem 1rem;
            border: 1px solid var(--border);
            border-radius: var(--radius);
            font-size: 0.9375rem;
            transition: var(--transition);
            color: var(--text);
            background-color: var(--card-bg);
            box-shadow: var(--shadow-sm);
        }

        input::placeholder, select::placeholder, textarea::placeholder {
            color: var(--text-light);
        }

        input:hover, select:hover, textarea:hover {
            border-color: var(--border-focus);
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(79, 172, 254, 0.15);
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1.5rem;
        }

        @media (max-width: 768px) {
            .grid {
                grid-template-columns: 1fr;
            }
        }

        .card {
            background: var(--card-bg);
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            padding: 2rem;
            margin-bottom: 2rem;
            transition: var(--transition);
            border: 1px solid var(--border);
        }

        .card:hover {
            box-shadow: var(--shadow-lg);
        }

        .card-title {
            font-size: 1.125rem;
            font-weight: 600;
            margin-bottom: 1.75rem;
            color: var(--text);
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 1rem;
            font-size: 0.9375rem;
        }

        th, td {
            padding: 1rem;
            text-align: left;
        }

        th {
            font-weight: 600;
            color: var(--text);
            background-color: var(--accent);
        }

        tr {
            border-bottom: 1px solid var(--border);
        }

        tbody tr:hover {
            background-color: var(--primary-light);
        }

        .text-right {
            text-align: right;
        }

        .text-center {
            text-align: center;
        }

        .item-row {
            display: grid;
            grid-template-columns: 2fr 0.5fr 0.5fr 1fr 0.75fr 1fr 1fr 0.2fr;
            gap: 0.75rem;
            margin-bottom: 1rem;
            align-items: center;
        }

        .item-row input, .item-row select {
            padding: 0.75rem;
        }

        .invoice-preview {
            padding: 3rem;
            background: white;
            box-shadow: var(--shadow);
            border-radius: var(--radius);
            max-width: 950px;
            margin: 0 auto;
            border: 1px solid var(--border);
        }

        .summary-table {
            width: auto;
            margin-left: auto;
            border-spacing: 0;
        }

        .summary-table th, .summary-table td {
            padding: 0.75rem 1.25rem;
            border-bottom: none;
        }

        .summary-table tr:last-child {
            border-top: 2px solid var(--border);
            font-weight: 600;
        }

        .tab-container {
            margin-bottom: 2.5rem;
        }

        .tabs {
            display: flex;
            border-bottom: 1px solid var(--border);
            margin-bottom: 2.5rem;
        }

        .tab {
            padding: 1rem 1.75rem;
            cursor: pointer;
            border-bottom: 2px solid transparent;
            color: var(--text-light);
            transition: var(--transition);
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .tab:hover {
            color: var(--text);
        }

        .tab.active {
            border-bottom: 2px solid var(--primary);
            color: var(--primary);
        }

        .tab-content {
            margin-top: 1.5rem;
        }

        .tab-pane {
            display: none;
        }

        .tab-pane.active {
            display: block;
        }

        .mt-2 {
            margin-top: 1.5rem;
        }

        .actions {
            display: flex;
            justify-content: flex-end;
            gap: 1rem;
            margin-top: 2rem;
        }

        .badge {
            display: inline-flex;
            align-items: center;
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 500;
        }

        .badge-success {
            background-color: var(--success-light);
            color: var(--success);
        }

        .badge-warning {
            background-color: rgba(255, 213, 114, 0.15);
            color: var(--warning);
        }

        .icon {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 1.25rem;
            height: 1.25rem;
            stroke-width: 2;
        }

        .add-item-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            color: var(--primary);
            font-weight: 500;
            cursor: pointer;
            padding: 0.875rem;
            border-radius: var(--radius);
            transition: var(--transition);
            border: 1px dashed var(--border);
            background: transparent;
            width: 100%;
            margin-top: 0.5rem;
        }

        .add-item-btn:hover {
            background-color: var(--primary-light);
            border-color: var(--primary);
        }

        .action-icon-btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 36px;
            height: 36px;
            border-radius: var(--radius-sm);
            background-color: var(--accent);
            color: var(--text);
            border: none;
            cursor: pointer;
            transition: var(--transition);
        }

        .action-icon-btn:hover {
            background-color: var(--primary-light);
            color: var(--primary);
            transform: translateY(-2px);
        }

        .remove-item-btn {
            background-color: var(--danger);
            color: white;
        }

        .remove-item-btn:hover {
            background-color: #e66570;
            color: white;
        }

        .section {
            background-color: var(--accent);
            border-radius: var(--radius);
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .preview-section {
            background-color: var(--primary-light);
            border-radius: var(--radius);
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .preview-box {
            background-color: white;
            border-radius: var(--radius-sm);
            padding: 1.25rem;
            box-shadow: var(--shadow-sm);
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes fadeOut {
            from { opacity: 1; }
            to { opacity: 0; }
        }

        .fadeIn {
            animation: fadeIn 0.3s ease forwards;
        }

        .fadeOut {
            animation: fadeOut 0.3s ease forwards;
        }

        @media print {
            body * {
                visibility: hidden;
            }
            .invoice-preview, .invoice-preview * {
                visibility: visible;
            }
            .invoice-preview {
                position: absolute;
                left: 0;
                top: 0;
                width: 100%;
                box-shadow: none;
                border: none;
            }
        }

        .seo-content {
            display: none;
        }
        
        .user-info {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: var(--text);
            font-weight: 500;
        }
        
        .user-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background-color: var(--primary-light);
            color: var(--primary);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
        }
        
        .empty-state {
            text-align: center;
            padding: 3rem;
            color: var(--text-light);
        }
        
        .empty-state svg {
            width: 80px;
            height: 80px;
            margin-bottom: 1.5rem;
            color: var(--primary-light);
        }
        
        .empty-state h3 {
            font-size: 1.25rem;
            margin-bottom: 0.75rem;
            color: var(--text);
        }
    </style>
</head>
<body>
    <div id="login-screen">
        <div class="login-container">
            <div style="text-align: center; margin-bottom: 2.5rem;">
                <div style="display: flex; align-items: center; justify-content: center; gap: 0.75rem; margin-bottom: 1.25rem;">
                    <div class="logo-icon">Fv</div>
                    <h1 style="font-size: 1.75rem; color: var(--text); font-weight: 600;">Easy FV</h1>
                </div>
                <p style="color: var(--text-light);">Twórz faktury szybko i profesjonalnie</p>
            </div>
            <form id="login-form">
                <div class="form-group">
                    <label for="email">E-mail</label>
                    <input type="email" id="email" required placeholder="twoj@email.pl">
                </div>
                <div class="form-group">
                    <label for="password">Hasło</label>
                    <input type="password" id="password" required placeholder="••••••••">
                </div>
                <button type="submit" class="btn" style="width: 100%;">Zaloguj się</button>
                <p style="text-align: center; margin-top: 1.5rem; font-size: 0.875rem; color: var(--text-light);">
                    Nie masz konta? <a href="#" id="register-link" style="color: var(--primary); text-decoration: none; font-weight: 500;">Zarejestruj się</a>
                </p>
            </form>
        </div>
    </div>

    <div id="app-screen" style="display: none;">
        <header class="container">
            <div class="logo">
                <div class="logo-icon">Fv</div>
                Easy FV
            </div>
            <div class="nav">
                <div class="user-info">
                    <div class="user-avatar" id="user-avatar"></div>
                    <span id="user-name"></span>
                </div>
                <a href="#" class="btn btn-secondary" id="btn-invoices">
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                        <polyline points="14 2 14 8 20 8"></polyline>
                        <line x1="16" y1="13" x2="8" y2="13"></line>
                        <line x1="16" y1="17" x2="8" y2="17"></line>
                        <polyline points="10 9 9 9 8 9"></polyline>
                    </svg>
                    Moje faktury
                </a>
                <a href="#" class="btn" id="btn-new-invoice">
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <line x1="12" y1="5" x2="12" y2="19"></line>
                        <line x1="5" y1="12" x2="19" y2="12"></line>
                    </svg>
                    Nowa faktura
                </a>
                <a href="#" class="btn btn-outline" id="logout-btn">
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>
                        <polyline points="16 17 21 12 16 7"></polyline>
                        <line x1="21" y1="12" x2="9" y2="12"></line>
                    </svg>
                    Wyloguj
                </a>
            </div>
        </header>

        <div class="container">
            <div id="invoice-list-screen" style="display: none;">
                <h1 style="font-size: 1.75rem; margin-bottom: 2rem; font-weight: 600;">Moje faktury</h1>
                <div class="card">
                    <table id="invoices-table">
                        <thead>
                            <tr>
                                <th style="border-radius: var(--radius-sm) 0 0 var(--radius-sm);">Numer</th>
                                <th>Data wystawienia</th>
                                <th>Nabywca</th>
                                <th>Kwota brutto</th>
                                <th>Status</th>
                                <th style="border-radius: 0 var(--radius-sm) var(--radius-sm) 0; text-align: right;">Akcje</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Faktury będą dodawane dynamicznie -->
                        </tbody>
                    </table>
                    <div id="empty-invoices" class="empty-state">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                            <polyline points="14 2 14 8 20 8"></polyline>
                            <line x1="16" y1="13" x2="8" y2="13"></line>
                            <line x1="16" y1="17" x2="8" y2="17"></line>
                            <polyline points="10 9 9 9 8 9"></polyline>
                        </svg>
                        <h3>Brak faktur</h3>
                        <p>Nie masz jeszcze żadnych faktur w systemie. Kliknij "Nowa faktura", aby utworzyć pierwszą fakturę.</p>
                    </div>
                </div>
            </div>

            <div id="new-invoice-screen" style="display: none;">
                <h1 style="font-size: 1.75rem; margin-bottom: 2rem; font-weight: 600;">Nowa faktura</h1>
                
                <div class="seo-content">
                    <h2>O Easy FV – Darmowy Program do Faktur</h2>
                    <p>Easy FV to nowoczesny, darmowy program online do tworzenia faktur VAT. Nasze narzędzie jest idealne dla freelancerów, małych firm i przedsiębiorców, którzy chcą szybko i profesjonalnie generować faktury. Oferujemy intuicyjny interfejs, możliwość pobierania faktur w formacie PDF i HTML, oraz responsywny design na urządzenia mobilne i desktopowe.</p>
                    <p>Korzystaj z Easy FV, aby tworzyć faktury online bez instalacji, z funkcjami takimi jak podgląd faktury, edycja pozycji, obliczanie podatków VAT (23%, 8%, 5%, 0%, zw.) i zarządzanie danymi sprzedawcy oraz nabywcy. Nasz program wspiera różne sposoby płatności, takie jak przelew, gotówka czy karta płatnicza, oraz pozwala zapisać faktury jako szkice.</p>
                    <h3>Dlaczego warto wybrać Easy FV?</h3>
                    <ul>
                        <li>100% darmowy i dostępny online</li>
                        <li>Prosty w obsłudze dla każdego</li>
                        <li>Bezpieczne zarządzanie danymi</li>
                        <li>Obsługa faktur dla firm i osób prywatnych</li>
                    </ul>
                    <p>Sprawdź Easy FV już dziś i zacznij tworzyć profesjonalne faktury w kilka minut! Odwiedź nas na: https://mysnjwe.github.io/easy-fv/</p>
                </div>

                <div class="tab-container">
                    <div class="tabs">
                        <div class="tab active" data-tab="invoice-data">
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                                <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                            </svg>
                            Dane faktury
                        </div>
                        <div class="tab" data-tab="invoice-preview">
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                                <circle cx="12" cy="12" r="3"></circle>
                            </svg>
                            Podgląd
                        </div>
                    </div>
                    
                    <div class="tab-content">
                        <div class="tab-pane active" id="invoice-data">
                            <div class="grid">
                                <div class="card">
                                    <div class="card-title">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                            <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                                            <line x1="16" y1="2" x2="16" y2="6"></line>
                                            <line x1="8" y1="2" x2="8" y2="6"></line>
                                            <line x1="3" y1="10" x2="21" y2="10"></line>
                                        </svg>
                                        Informacje o fakturze
                                    </div>
                                    <div class="form-group">
                                        <label>Numer faktury</label>
                                        <input type="text" id="invoice-number" value="FV/2025/02/002">
                                    </div>
                                    <div class="grid">
                                        <div class="form-group">
                                            <label>Data wystawienia</label>
                                            <input type="date" id="issue-date" value="2025-02-28">
                                        </div>
                                        <div class="form-group">
                                            <label>Data sprzedaży/dostawy</label>
                                            <input type="date" id="delivery-date" value="2025-02-28">
                                        </div>
                                    </div>
                                    <div class="grid">
                                        <div class="form-group">
                                            <label>Sposób płatności</label>
                                            <select id="payment-method">
                                                <option value="transfer">Przelew</option>
                                                <option value="cash">Gotówka</option>
                                                <option value="card">Karta płatnicza</option>
                                            </select>
                                        </div>
                                        <div class="form-group">
                                            <label>Termin płatności (dni)</label>
                                            <select id="payment-term">
                                                <option value="7">7 dni</option>
                                                <option value="14" selected>14 dni</option>
                                                <option value="30">30 dni</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="form-group" style="margin-bottom: 0;">
                                        <label>Status płatności</label>
                                        <select id="payment-status">
                                            <option value="not-paid">Do zapłaty</option>
                                            <option value="paid">Zapłacono</option>
                                        </select>
                                    </div>
                                </div>
                                
                                <div class="card">
                                    <div class="card-title">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                            <path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"></path>
                                            <rect x="8" y="2" width="8" height="4" rx="1" ry="1"></rect>
                                        </svg>
                                        Dane sprzedawcy
                                    </div>
                                    <div class="form-group">
                                        <label>Nazwa firmy/osoby</label>
                                        <input type="text" id="seller-name" placeholder="Nazwa firmy/osoby" value="Andrzej Kowalski">
                                    </div>
                                    <div class="form-group">
                                        <label>Adres</label>
                                        <input type="text" id="seller-address" placeholder="Ulica, numer" value="ul. Przedsiębiorcza 1">
                                    </div>
                                    <div class="grid">
                                        <div class="form-group">
                                            <label>Kod pocztowy</label>
                                            <input type="text" id="seller-postal-code" placeholder="00-000" value="01-001">
                                        </div>
                                        <div class="form-group">
                                            <label>Miejscowość</label>
                                            <input type="text" id="seller-city" placeholder="Miasto" value="Warszawa">
                                        </div>
                                    </div>
                                    <div class="form-group" style="margin-bottom: 0;">
                                        <label>NIP</label>
                                        <input type="text" id="seller-tax-id" placeholder="000-000-00-00" value="123-456-78-90">
                                    </div>
                                </div>
                            </div>
                            
                            <div class="card mt-2">
                                <div class="card-title">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                        <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                                        <circle cx="12" cy="7" r="4"></circle>
                                    </svg>
                                    Dane nabywcy
                                </div>
                                <div class="form-group">
                                    <label>Nazwa firmy/osoby</label>
                                    <input type="text" id="buyer-name" placeholder="Nazwa firmy/osoby">
                                </div>
                                <div class="form-group">
                                    <label>Adres</label>
                                    <input type="text" id="buyer-address" placeholder="Ulica, numer">
                                </div>
                                <div class="grid">
                                    <div class="form-group">
                                        <label>Kod pocztowy</label>
                                        <input type="text" id="buyer-postal-code" placeholder="00-000">
                                    </div>
                                    <div class="form-group">
                                        <label>Miejscowość</label>
                                        <input type="text" id="buyer-city" placeholder="Miasto">
                                    </div>
                                </div>
                                <div class="form-group" style="margin-bottom: 0;">
                                    <label>NIP</label>
                                    <input type="text" id="buyer-tax-id" placeholder="000-000-00-00">
                                </div>
                            </div>
                            
                            <div class="card mt-2">
                                <div class="card-title">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                        <line x1="16.5" y1="9.4" x2="7.5" y2="4.21"></line>
                                        <path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"></path>
                                        <polyline points="3.27 6.96 12 12.01 20.73 6.96"></polyline>
                                        <line x1="12" y1="22.08" x2="12" y2="12"></line>
                                    </svg>
                                    Pozycje faktury
                                </div>
                                <div id="invoice-items" style="margin-bottom: 1rem;">
                                    <div class="item-row" style="background-color: var(--accent); padding: 0.75rem; border-radius: var(--radius); margin-bottom: 1rem;">
                                        <strong>Nazwa</strong>
                                        <strong>Ilość</strong>
                                        <strong>J.m.</strong>
                                        <strong>Cena netto</strong>
                                        <strong>VAT</strong>
                                        <strong>Netto</strong>
                                        <strong>Brutto</strong>
                                        <span></span>
                                    </div>
                                    <div class="item-row" id="item-1" style="background-color: var(--primary-light); padding: 0.75rem; border-radius: var(--radius);">
                                        <input type="text" name="item-name" placeholder="Nazwa towaru/usługi">
                                        <input type="number" name="item-quantity" min="1" step="1" value="1" onchange="calculateItemTotals(this)" oninput="calculateItemTotals(this)">
                                        <select name="item-unit">
                                            <option value="szt.">szt.</option>
                                            <option value="godz.">godz.</option>
                                            <option value="usł.">usł.</option>
                                            <option value="kg">kg</option>
                                        </select>
                                        <input type="text" name="item-price" placeholder="0,00" onchange="calculateItemTotals(this)" oninput="calculateItemTotals(this)">
                                        <select name="item-tax" onchange="calculateItemTotals(this)">
                                            <option value="23">23%</option>
                                            <option value="8">8%</option>
                                            <option value="5">5%</option>
                                            <option value="0">0%</option>
                                            <option value="zw">zw.</option>
                                        </select>
                                        <input type="text" name="item-net-value" readonly placeholder="0,00">
                                        <input type="text" name="item-gross-value" readonly placeholder="0,00">
                                        <button class="action-icon-btn remove-item-btn" onclick="removeItem(this)" title="Usuń pozycję">
                                            <svg xmlns="http://www.w3.org/2000/svg" class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                                <polyline points="3 6 5 6 21 6"></polyline>
                                                <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                                                <line x1="10" y1="11" x2="10" y2="17"></line>
                                                <line x1="14" y1="11" x2="14" y2="17"></line>
                                            </svg>
                                        </button>
                                    </div>
                                </div>
                                
                                <button class="add-item-btn" id="add-item">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                        <circle cx="12" cy="12" r="10"></circle>
                                        <line x1="12" y1="8" x2="12" y2="16"></line>
                                        <line x1="8" y1="12" x2="16" y2="12"></line>
                                    </svg>
                                    Dodaj pozycję
                                </button>
                                
                                <div class="section mt-2">
                                    <table class="summary-table" id="summary-table">
                                        <tr>
                                            <th>Razem netto:</th>
                                            <td class="text-right" id="total-net">0,00 zł</td>
                                        </tr>
                                        <tr>
                                            <th>Razem podatek VAT:</th>
                                            <td class="text-right" id="total-tax">0,00 zł</td>
                                        </tr>
                                        <tr>
                                            <th style="font-size: 1.1rem; padding-top: 1rem;">Razem brutto:</th>
                                            <td class="text-right" style="font-size: 1.1rem; font-weight: 600; padding-top: 1rem;" id="total-gross">0,00 zł</td>
                                        </tr>
                                    </table>
                                </div>
                            </div>
                            
                            <div class="actions">
                                <button class="btn btn-outline" id="save-draft">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                        <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"></path>
                                        <polyline points="17 21 17 13 7 13 7 21"></polyline>
                                        <polyline points="7 3 7 8 15 8"></polyline>
                                    </svg>
                                    Zapisz fakturę
                                </button>
                            </div>
                        </div>
                        
                        <div class="tab-pane" id="invoice-preview">
                            <div class="invoice-preview" id="preview-container">
                                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2.5rem;">
                                    <div>
                                        <h2 style="font-size: 1.75rem; margin-bottom: 0.75rem; font-weight: 600;">Faktura VAT</h2>
                                        <p><strong>Nr</strong> <span id="preview-invoice-number">FV/2025/02/002</span></p>
                                    </div>
                                    <div style="text-align: right;">
                                        <p><strong>Data wystawienia:</strong> <span id="preview-issue-date">28.02.2025</span></p>
                                        <p><strong>Data sprzedaży:</strong> <span id="preview-delivery-date">28.02.2025</span></p>
                                        <p><strong>Termin płatności:</strong> <span id="preview-due-date">14.03.2025</span></p>
                                    </div>
                                </div>
                                
                                <div style="display: flex; justify-content: space-between; margin-bottom: 2.5rem;">
                                    <div style="width: 48%;">
                                        <h3 style="font-size: 1rem; margin-bottom: 0.75rem; color: var(--text-light); font-weight: 500;">Sprzedawca</h3>
                                        <div class="preview-box">
                                            <p style="font-weight: 600;" id="preview-seller-name">Andrzej Kowalski</p>
                                            <p id="preview-seller-address">ul. Przedsiębiorcza 1</p>
                                            <p id="preview-seller-city">01-001 Warszawa</p>
                                            <p>NIP: <span id="preview-seller-tax-id">123-456-78-90</span></p>
                                        </div>
                                    </div>
                                    <div style="width: 48%;">
                                        <h3 style="font-size: 1rem; margin-bottom: 0.75rem; color: var(--text-light); font-weight: 500;">Nabywca</h3>
                                        <div class="preview-box">
                                            <p style="font-weight: 600;" id="preview-buyer-name">[Nazwa firmy/osoby]</p>
                                            <p id="preview-buyer-address">[Adres]</p>
                                            <p id="preview-buyer-city">[Kod i miasto]</p>
                                            <p>NIP: <span id="preview-buyer-tax-id">[NIP]</span></p>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="preview-section">
                                    <table style="margin-bottom: 0; background-color: white; border-radius: var(--radius); table-layout: fixed; width: 100%;">
                                        <thead>
                                            <tr>
                                                <th style="width: 40px; border-radius: var(--radius-sm) 0 0 0; white-space: nowrap;">Lp.</th>
                                                <th style="width: 25%;">Nazwa towaru/usługi</th>
                                                <th style="width: 50px; white-space: nowrap;">Ilość</th>
                                                <th style="width: 50px; white-space: nowrap;">J.m.</th>
                                                <th style="width: 110px; white-space: nowrap;">Cena netto</th>
                                                <th style="width: 110px; white-space: nowrap;">Wartość netto</th>
                                                <th style="width: 60px; white-space: nowrap;">VAT</th>
                                                <th style="width: 110px; white-space: nowrap;">Kwota VAT</th>
                                                <th style="border-radius: 0 var(--radius-sm) 0 0; width: 130px; white-space: nowrap;">Wartość brutto</th>
                                            </tr>
                                        </thead>
                                        <tbody id="preview-items">
                                        </tbody>
                                    </table>
                                </div>
                                
                                <div style="display: flex; justify-content: space-between; margin-bottom: 2.5rem;">
                                    <div style="width: 60%;">
                                        <p style="margin-bottom: 0.5rem;"><strong>Sposób płatności:</strong> <span id="preview-payment-method">Przelew</span></p>
                                        <p><strong>Słownie:</strong> <span id="preview-amount-in-words">zero złotych 00/100</span></p>
                                    </div>
                                    <div style="width: 35%;">
                                        <div class="section" style="margin-bottom: 0;">
                                            <table style="width: 100%;" id="preview-summary-table">
                                                <tr>
                                                    <th style="white-space: nowrap;">Razem netto:</th>
                                                    <td class="text-right" style="white-space: nowrap;" id="preview-total-net">0,00 zł</td>
                                                </tr>
                                                <tr>
                                                    <th style="white-space: nowrap;">Razem VAT:</th>
                                                    <td class="text-right" style="white-space: nowrap;" id="preview-total-tax">0,00 zł</td>
                                                </tr>
                                                <tr style="font-weight: 700;">
                                                    <th style="white-space: nowrap;">Razem brutto:</th>
                                                    <td class="text-right" style="white-space: nowrap;" id="preview-total-gross">0,00 zł</td>
                                                </tr>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                                
                                <div style="margin-top: 4rem; display: flex; justify-content: space-between;">
                                    <div style="text-align: center; width: 40%;">
                                        <div style="border-top: 1px solid var(--border); padding-top: 0.5rem;">
                                            <p style="color: var(--text-light); font-size: 0.875rem;">Osoba upoważniona do wystawienia</p>
                                        </div>
                                    </div>
                                    <div style="text-align: center; width: 40%;">
                                        <div style="border-top: 1px solid var(--border); padding-top: 0.5rem;">
                                            <p style="color: var(--text-light); font-size: 0.875rem;">Osoba upoważniona do odbioru</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="actions">
                                <button class="btn btn-outline" id="btn-print">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                        <polyline points="6 9 6 2 18 2 18 9"></polyline>
                                        <path d="M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2"></path>
                                        <rect x="6" y="14" width="12" height="8"></rect>
                                    </svg>
                                    Drukuj
                                </button>
                                <button class="btn" id="btn-download-pdf">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                                        <polyline points="7 10 12 15 17 10"></polyline>
                                        <line x1="12" y1="15" x2="12" y2="3"></line>
                                    </svg>
                                    Pobierz PDF
                                </button>
                                <button class="btn btn-secondary" id="btn-download-html">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                                        <polyline points="7 10 12 15 17 10"></polyline>
                                        <line x1="12" y1="15" x2="12" y2="3"></line>
                                    </svg>
                                    Pobierz HTML
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Sprawdzamy, czy użytkownik jest zalogowany
            checkLoginState();
            
            // Obsługa formularza logowania
            document.getElementById('login-form').addEventListener('submit', function(e) {
                e.preventDefault();
                const email = document.getElementById('email').value;
                const password = document.getElementById('password').value;
                
                if (!email || !password) {
                    alert('Uzupełnij dane logowania');
                    return;
                }
                
                // W tej wersji prosta walidacja
                if (password.length < 3) {
                    alert('Hasło powinno mieć co najmniej 3 znaki');
                    return;
                }
                
                // Zapisujemy dane w localStorage
                localStorage.setItem('user', JSON.stringify({
                    email: email,
                    name: email.split('@')[0], // Proste wyciągnięcie imienia z emaila
                    isLoggedIn: true,
                    initials: email[0].toUpperCase() + (email.indexOf('@') > 1 ? email[1].toUpperCase() : '')
                }));
                
                showDashboard();
            });
            
            // Obsługa wylogowania
            document.getElementById('logout-btn').addEventListener('click', function() {
                localStorage.removeItem('user');
                checkLoginState();
            });

            // Przypisujemy handlery do przycisków
            document.getElementById('btn-download-html').addEventListener('click', downloadHTMLFile);
            document.getElementById('btn-download-pdf').addEventListener('click', downloadPDFFile);
            document.getElementById('btn-print').addEventListener('click', printInvoice);
            
            const firstItemInputs = document.querySelectorAll('#item-1 input, #item-1 select');
            firstItemInputs.forEach(input => {
                if (input.name === 'item-quantity' || input.name === 'item-price') {
                    input.addEventListener('input', function() {
                        calculateItemTotals(this);
                    });
                } else if (input.name === 'item-tax') {
                    input.addEventListener('change', function() {
                        calculateItemTotals(this);
                    });
                }
            });

            // Ustaw formatowanie cen
            setupPriceFormatting();
            
            // Zapisz fakturę przy kliknięciu przycisku "Zapisz fakturę"
            document.getElementById('save-draft').addEventListener('click', function() {
                saveInvoice();
            });
        });
        
        function checkLoginState() {
            const user = JSON.parse(localStorage.getItem('user'));
            if (user && user.isLoggedIn) {
                showDashboard();
                document.getElementById('user-name').textContent = user.name;
                document.getElementById('user-avatar').textContent = user.initials || 'U';
            } else {
                document.getElementById('login-screen').style.display = 'block';
                document.getElementById('app-screen').style.display = 'none';
            }
        }

        function showDashboard() {
            document.getElementById('login-screen').style.display = 'none';
            document.getElementById('app-screen').style.display = 'block';
            document.getElementById('invoice-list-screen').style.display = 'block';
            document.getElementById('new-invoice-screen').style.display = 'none';
            
            loadInvoices(); // Ładowanie historii faktur
        }

        function loadInvoices() {
            const invoices = JSON.parse(localStorage.getItem('invoices')) || [];
            const tableBody = document.querySelector('#invoices-table tbody');
            
            // Wyczyść obecną zawartość tabeli
            tableBody.innerHTML = '';
            
            const emptyState = document.getElementById('empty-invoices');
            
            // Jeśli nie ma faktur, pokaż komunikat
            if (invoices.length === 0) {
                emptyState.style.display = 'block';
                return;
            }
            
            // W przeciwnym razie ukryj komunikat i pokaż faktury
            emptyState.style.display = 'none';
            
            // Dodaj każdą fakturę do tabeli
            invoices.forEach(invoice => {
                const row = document.createElement('tr');
                
                const formattedDate = invoice.issueDate ? new Date(invoice.issueDate).toLocaleDateString('pl-PL') : 'Brak daty';
                let grossAmount = '0,00 zł';
                
                if (invoice.total && invoice.total.gross) {
                    if (typeof invoice.total.gross === 'string') {
                        grossAmount = invoice.total.gross.includes('zł') ? invoice.total.gross : invoice.total.gross + ' zł';
                    } else {
                        grossAmount = formatCurrency(invoice.total.gross);
                    }
                }
                
                const status = invoice.status || 'not-paid';
                const statusText = status === 'paid' ? 'Zapłacono' : 'Do zapłaty';
                const statusClass = status === 'paid' ? 'badge-success' : 'badge-warning';
                
                row.innerHTML = `
                    <td>${invoice.number || 'Brak numeru'}</td>
                    <td>${formattedDate}</td>
                    <td>${invoice.buyer?.name || '[Brak nabywcy]'}</td>
                    <td>${grossAmount}</td>
                    <td><span class="badge ${statusClass}">${statusText}</span></td>
                    <td class="text-right">
                        <button class="action-icon-btn" onclick="viewInvoice('${invoice.id}')">
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                                <circle cx="12" cy="12" r="3"></circle>
                            </svg>
                        </button>
                        <button class="action-icon-btn" onclick="downloadInvoicePDF('${invoice.id}')">
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                                <polyline points="7 10 12 15 17 10"></polyline>
                                <line x1="12" y1="15" x2="12" y2="3"></line>
                            </svg>
                        </button>
                    </td>
                `;
                
                tableBody.appendChild(row);
            });
        }

        function viewInvoice(invoiceId) {
            const invoices = JSON.parse(localStorage.getItem('invoices')) || [];
            const invoice = invoices.find(inv => inv.id === invoiceId);
            
            if (!invoice) {
                alert('Nie znaleziono faktury');
                return;
            }
            
            clearInvoiceForm();
            
            // Ładowanie danych do formularza
            document.getElementById('invoice-number').value = invoice.number || '';
            document.getElementById('issue-date').value = invoice.issueDate || '';
            document.getElementById('delivery-date').value = invoice.deliveryDate || invoice.issueDate || '';
            
            if (invoice.paymentMethod) {
                document.getElementById('payment-method').value = invoice.paymentMethod;
            }
            
            if (invoice.paymentTerm) {
                document.getElementById('payment-term').value = invoice.paymentTerm;
            }
            
            if (invoice.status) {
                document.getElementById('payment-status').value = invoice.status;
            }
            
            // Dane sprzedawcy
            if (invoice.seller) {
                document.getElementById('seller-name').value = invoice.seller.name || '';
                document.getElementById('seller-address').value = invoice.seller.address || '';
                document.getElementById('seller-postal-code').value = invoice.seller.postalCode || '';
                document.getElementById('seller-city').value = invoice.seller.city || '';
                document.getElementById('seller-tax-id').value = invoice.seller.taxId || '';
            }
            
            // Dane nabywcy
            if (invoice.buyer) {
                document.getElementById('buyer-name').value = invoice.buyer.name || '';
                document.getElementById('buyer-address').value = invoice.buyer.address || '';
                document.getElementById('buyer-postal-code').value = invoice.buyer.postalCode || '';
                document.getElementById('buyer-city').value = invoice.buyer.city || '';
                document.getElementById('buyer-tax-id').value = invoice.buyer.taxId || '';
            }
            
            // Pozycje faktury
            if (invoice.items && invoice.items.length > 0) {
                // Usuń wszystkie pozycje oprócz pierwszej
                const itemsContainer = document.getElementById('invoice-items');
                const headerRow = itemsContainer.querySelector('.item-row:first-child');
                const firstItemRow = document.querySelector('#item-1');
                
                // Wyczyść wszystkie wiersze
                itemsContainer.innerHTML = '';
                itemsContainer.appendChild(headerRow);
                
                // Dodaj pozycje z faktury
                invoice.items.forEach((item, index) => {
                    if (index === 0) {
                        // Uzupełnij pierwszy wiersz
                        firstItemRow.querySelector('[name="item-name"]').value = item.name || '';
                        firstItemRow.querySelector('[name="item-quantity"]').value = item.quantity || '1';
                        firstItemRow.querySelector('[name="item-unit"]').value = item.unit || 'szt.';
                        firstItemRow.querySelector('[name="item-price"]').value = formatCurrencyInput(item.price || 0);
                        firstItemRow.querySelector('[name="item-tax"]').value = item.taxRate || '23';
                        
                        if (item.netValue) {
                            firstItemRow.querySelector('[name="item-net-value"]').value = formatCurrencyInput(item.netValue);
                        }
                        
                        if (item.grossValue) {
                            firstItemRow.querySelector('[name="item-gross-value"]').value = formatCurrencyInput(item.grossValue);
                        }
                        
                        itemsContainer.appendChild(firstItemRow);
                    } else {
                        // Dodaj nowe wiersze dla kolejnych pozycji
                        const newRow = document.createElement('div');
                        newRow.className = 'item-row';
                        newRow.id = `item-${index + 1}`;
                        newRow.style.backgroundColor = 'var(--primary-light)';
                        newRow.style.padding = '0.75rem';
                        newRow.style.borderRadius = 'var(--radius)';
                        newRow.style.marginBottom = '1rem';
                        newRow.style.display = 'grid';
                        newRow.style.gridTemplateColumns = '2fr 0.5fr 0.5fr 1fr 0.75fr 1fr 1fr 0.2fr';
                        
                        newRow.innerHTML = `
                            <input type="text" name="item-name" placeholder="Nazwa towaru/usługi" value="${item.name || ''}">
                            <input type="number" name="item-quantity" min="1" step="1" value="${item.quantity || '1'}" onchange="calculateItemTotals(this)" oninput="calculateItemTotals(this)">
                            <select name="item-unit">
                                <option value="szt." ${item.unit === 'szt.' ? 'selected' : ''}>szt.</option>
                                <option value="godz." ${item.unit === 'godz.' ? 'selected' : ''}>godz.</option>
                                <option value="usł." ${item.unit === 'usł.' ? 'selected' : ''}>usł.</option>
                                <option value="kg" ${item.unit === 'kg' ? 'selected' : ''}>kg</option>
                            </select>
                            <input type="text" name="item-price" placeholder="0,00" value="${formatCurrencyInput(item.price || 0)}" onchange="calculateItemTotals(this)" oninput="calculateItemTotals(this)">
                            <select name="item-tax" onchange="calculateItemTotals(this)">
                                <option value="23" ${item.taxRate === '23' || item.taxRate === 23 ? 'selected' : ''}>23%</option>
                                <option value="8" ${item.taxRate === '8' || item.taxRate === 8 ? 'selected' : ''}>8%</option>
                                <option value="5" ${item.taxRate === '5' || item.taxRate === 5 ? 'selected' : ''}>5%</option>
                                <option value="0" ${item.taxRate === '0' || item.taxRate === 0 ? 'selected' : ''}>0%</option>
                                <option value="zw" ${item.taxRate === 'zw' ? 'selected' : ''}>zw.</option>
                            </select>
                            <input type="text" name="item-net-value" readonly placeholder="0,00" value="${item.netValue ? formatCurrencyInput(item.netValue) : ''}">
                            <input type="text" name="item-gross-value" readonly placeholder="0,00" value="${item.grossValue ? formatCurrencyInput(item.grossValue) : ''}">
                            <button class="action-icon-btn remove-item-btn" onclick="removeItem(this)" title="Usuń pozycję">
                                <svg xmlns="http://www.w3.org/2000/svg" class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <polyline points="3 6 5 6 21 6"></polyline>
                                    <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                                    <line x1="10" y1="11" x2="10" y2="17"></line>
                                    <line x1="14" y1="11" x2="14" y2="17"></line>
                                </svg>
                            </button>
                        `;
                        
                        itemsContainer.appendChild(newRow);
                        
                        // Dodanie obsługi zdarzeń
                        const inputs = newRow.querySelectorAll('input, select');
                        inputs.forEach(input => {
                            if (input.name === 'item-quantity' || input.name === 'item-price') {
                                input.addEventListener('input', function() {
                                    calculateItemTotals(this);
                                });
                            } else if (input.name === 'item-tax') {
                                input.addEventListener('change', function() {
                                    calculateItemTotals(this);
                                });
                            }
                        });
                    }
                });
                
                // Formatowanie cen dla nowych wierszy
                setupPriceFormatting();
                
                // Aktualizacja sumy
                updateTotals();
            } else {
                // Jeśli nie ma pozycji, przygotuj domyślny formularz
                clearInvoiceItems();
            }
            
            // Przełącz na widok faktury
            document.getElementById('invoice-list-screen').style.display = 'none';
            document.getElementById('new-invoice-screen').style.display = 'block';
            
            // Aktualizacja faktury ID
            document.getElementById('save-draft').setAttribute('data-invoice-id', invoiceId);
        }

        function clearInvoiceForm() {
            // Resetuj podstawowe informacje o fakturze
            document.getElementById('invoice-number').value = generateInvoiceNumber();
            document.getElementById('issue-date').valueAsDate = new Date();
            document.getElementById('delivery-date').valueAsDate = new Date();
            document.getElementById('payment-method').value = 'transfer';
            document.getElementById('payment-term').value = '14';
            document.getElementById('payment-status').value = 'not-paid';
            
            // Dane sprzedawcy z lokalnego storage
            const user = JSON.parse(localStorage.getItem('user'));
            if (user) {
                document.getElementById('seller-name').value = user.name || 'Andrzej Kowalski';
            } else {
                document.getElementById('seller-name').value = 'Andrzej Kowalski';
            }
            document.getElementById('seller-address').value = 'ul. Przedsiębiorcza 1';
            document.getElementById('seller-postal-code').value = '01-001';
            document.getElementById('seller-city').value = 'Warszawa';
            document.getElementById('seller-tax-id').value = '123-456-78-90';
            
            // Dane nabywcy
            document.getElementById('buyer-name').value = '';
            document.getElementById('buyer-address').value = '';
            document.getElementById('buyer-postal-code').value = '';
            document.getElementById('buyer-city').value = '';
            document.getElementById('buyer-tax-id').value = '';
            
            // Pozycje faktury
            clearInvoiceItems();
            
            // Usuń ID faktury
            document.getElementById('save-draft').removeAttribute('data-invoice-id');
        }

        function clearInvoiceItems() {
            const itemsContainer = document.getElementById('invoice-items');
            const headerRow = itemsContainer.querySelector('.item-row:first-child');
            const firstItemRow = document.getElementById('item-1');
            
            // Wyczyść wszystkie wiersze
            itemsContainer.innerHTML = '';
            itemsContainer.appendChild(headerRow);
            
            // Resetuj pierwszy wiersz
            firstItemRow.querySelector('[name="item-name"]').value = '';
            firstItemRow.querySelector('[name="item-quantity"]').value = '1';
            firstItemRow.querySelector('[name="item-unit"]').value = 'szt.';
            firstItemRow.querySelector('[name="item-price"]').value = '';
            firstItemRow.querySelector('[name="item-tax"]').value = '23';
            firstItemRow.querySelector('[name="item-net-value"]').value = '';
            firstItemRow.querySelector('[name="item-gross-value"]').value = '';
            
            itemsContainer.appendChild(firstItemRow);
            
            // Aktualizacja sumy
            updateTotals();
        }

        function saveInvoice() {
            // Pobierz ID faktury, jeśli istnieje (edycja) lub utwórz nowy (nowa faktura)
            const invoiceId = document.getElementById('save-draft').getAttribute('data-invoice-id') || generateInvoiceId();
            
            // Pobierz dane faktury z formularza
            const invoiceData = {
                id: invoiceId,
                number: document.getElementById('invoice-number').value,
                issueDate: document.getElementById('issue-date').value,
                deliveryDate: document.getElementById('delivery-date').value,
                paymentMethod: document.getElementById('payment-method').value,
                paymentTerm: document.getElementById('payment-term').value,
                status: document.getElementById('payment-status').value,
                seller: {
                    name: document.getElementById('seller-name').value,
                    address: document.getElementById('seller-address').value,
                    postalCode: document.getElementById('seller-postal-code').value,
                    city: document.getElementById('seller-city').value,
                    taxId: document.getElementById('seller-tax-id').value
                },
                buyer: {
                    name: document.getElementById('buyer-name').value,
                    address: document.getElementById('buyer-address').value,
                    postalCode: document.getElementById('buyer-postal-code').value,
                    city: document.getElementById('buyer-city').value,
                    taxId: document.getElementById('buyer-tax-id').value
                },
                items: [],
                total: {
                    net: parseFloat(document.getElementById('total-net').textContent.replace(/\s/g, '').replace('zł', '').replace(',', '.')) || 0,
                    tax: parseFloat(document.getElementById('total-tax').textContent.replace(/\s/g, '').replace('zł', '').replace(',', '.')) || 0,
                    gross: parseFloat(document.getElementById('total-gross').textContent.replace(/\s/g, '').replace('zł', '').replace(',', '.')) || 0
                },
                modifiedAt: new Date().toISOString()
            };
            
            // Dodaj datę utworzenia dla nowych faktur
            if (!document.getElementById('save-draft').getAttribute('data-invoice-id')) {
                invoiceData.createdAt = new Date().toISOString();
            }
            
            // Pobierz pozycje faktury
            document.querySelectorAll('.item-row').forEach((row, index) => {
                if (index === 0) return; // Pomiń nagłówek
                
                const name = row.querySelector('[name="item-name"]').value;
                if (!name) return; // Pomiń puste pozycje
                
                const quantity = parseFloat(row.querySelector('[name="item-quantity"]').value) || 0;
                const unit = row.querySelector('[name="item-unit"]').value;
                const priceText = row.querySelector('[name="item-price"]').value;
                const price = parseFloat(priceText.replace(/\s/g, '').replace(',', '.')) || 0;
                const taxRate = row.querySelector('[name="item-tax"]').value;
                const netValueText = row.querySelector('[name="item-net-value"]').value;
                const netValue = parseFloat(netValueText.replace(/\s/g, '').replace(',', '.')) || 0;
                const grossValueText = row.querySelector('[name="item-gross-value"]').value;
                const grossValue = parseFloat(grossValueText.replace(/\s/g, '').replace(',', '.')) || 0;
                
                invoiceData.items.push({
                    name,
                    quantity,
                    unit,
                    price,
                    taxRate,
                    netValue,
                    grossValue
                });
            });
            
            // Pobierz istniejące faktury lub inicjalizuj pustą tablicę
            let invoices = JSON.parse(localStorage.getItem('invoices')) || [];
            
            // Sprawdź, czy faktura istnieje
            const existingInvoiceIndex = invoices.findIndex(inv => inv.id === invoiceId);
            
            if (existingInvoiceIndex >= 0) {
                // Aktualizuj istniejącą fakturę
                invoices[existingInvoiceIndex] = invoiceData;
                alert('Faktura została zaktualizowana');
            } else {
                // Dodaj nową fakturę
                invoices.push(invoiceData);
                alert('Faktura została zapisana');
            }
            
            // Zapisz z powrotem do localStorage
            localStorage.setItem('invoices', JSON.stringify(invoices));
            
            // Ustaw ID faktury w przycisku
            document.getElementById('save-draft').setAttribute('data-invoice-id', invoiceId);
            
            // Odśwież listę faktur
            loadInvoices();
            
            return invoiceData;
        }

        function downloadInvoicePDF(invoiceId) {
            const invoices = JSON.parse(localStorage.getItem('invoices')) || [];
            const invoice = invoices.find(inv => inv.id === invoiceId);
            
            if (!invoice) {
                alert('Nie znaleziono faktury');
                return;
            }
            
            // Załaduj fakturę do formularza
            viewInvoice(invoiceId);
            
            // Przełącz na zakładkę podglądu
            document.querySelector('.tab[data-tab="invoice-preview"]').click();
            
            // Pobierz PDF
            document.getElementById('btn-download-pdf').click();
        }

        function generateInvoiceId() {
            return Date.now().toString(36) + Math.random().toString(36).substr(2);
        }

        function generateInvoiceNumber() {
            const today = new Date();
            const year = today.getFullYear();
            const month = String(today.getMonth() + 1).padStart(2, '0');
            
            // Sprawdź, ile jest już faktur w danym miesiącu
            const invoices = JSON.parse(localStorage.getItem('invoices')) || [];
            const currentMonthInvoices = invoices.filter(inv => {
                if (!inv.number) return false;
                const regex = new RegExp(`FV/${year}/${month}/\\d+`);
                return regex.test(inv.number);
            });
            
            const nextNumber = (currentMonthInvoices.length + 1).toString().padStart(3, '0');
            return `FV/${year}/${month}/${nextNumber}`;
        }
        
        function setupPriceFormatting() {
            document.querySelectorAll('.item-row').forEach(row => {
                if (!row.querySelector('strong')) { // Skip header row
                    const priceInput = row.querySelector('[name="item-price"]');
                    
                    priceInput.addEventListener('focus', function() {
                        // Gdy pole jest aktywne, usuwamy formatowanie i przecinek
                        const rawValue = this.value.replace(/\s/g, '').replace(',', '.');
                        if (parseFloat(rawValue) === 0 || isNaN(parseFloat(rawValue))) {
                            this.value = '';  // Całkowicie puste pole
                        } else {
                            this.value = parseFloat(rawValue).toString().replace('.', ',');
                        }
                    });

                    priceInput.addEventListener('blur', function() {
                        // Przy wyjściu z pola, jeśli jest puste, zostawiamy puste
                        if (this.value === '') {
                            return;
                        }
                        
                        // W przeciwnym razie formatujemy z przecinkiem i spacjami
                        let value = this.value.replace(',', '.');
                        if (value.indexOf('.') === -1) {
                            // Jeśli nie ma przecinka, dodajemy go
                            value = value + '.00';
                        }
                        value = parseFloat(value) || 0;
                        this.value = formatCurrencyInput(value);
                    });

                    // Format initial value if not empty
                    if (priceInput.value && priceInput.value !== '0,00' && priceInput.value !== '0') {
                        const value = parseFloat(priceInput.value.replace(/\s/g, '').replace(',', '.')) || 0;
                        priceInput.value = formatCurrencyInput(value);
                    } else {
                        priceInput.value = '';  // Początkowo puste
                    }
                }
            });
        }
        
        document.querySelectorAll('.tab').forEach(tab => {
            tab.addEventListener('click', function() {
                document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                this.classList.add('active');
                
                document.querySelectorAll('.tab-pane').forEach(pane => pane.classList.remove('active'));
                const pane = document.getElementById(this.dataset.tab);
                pane.classList.add('active');
                pane.classList.add('fadeIn');
                
                if (this.dataset.tab === 'invoice-preview') {
                    updatePreview();
                }
            });
        });
        
        document.getElementById('add-item').addEventListener('click', function() {
            const itemsContainer = document.getElementById('invoice-items');
            const itemCount = itemsContainer.querySelectorAll('.item-row').length - 1;
            const newItem = document.createElement('div');
            newItem.className = 'item-row';
            newItem.id = `item-${itemCount + 1}`;
            newItem.style.backgroundColor = 'var(--primary-light)';
            newItem.style.padding = '0.75rem';
            newItem.style.borderRadius = 'var(--radius)';
            newItem.style.marginBottom = '1rem';
            newItem.style.display = 'grid';
            newItem.style.gridTemplateColumns = '2fr 0.5fr 0.5fr 1fr 0.75fr 1fr 1fr 0.2fr';
            newItem.innerHTML = `
                <input type="text" name="item-name" placeholder="Nazwa towaru/usługi">
                <input type="number" name="item-quantity" min="1" step="1" value="1" onchange="calculateItemTotals(this)" oninput="calculateItemTotals(this)">
                <select name="item-unit">
                    <option value="szt.">szt.</option>
                    <option value="godz.">godz.</option>
                    <option value="usł.">usł.</option>
                    <option value="kg">kg</option>
                </select>
                <input type="text" name="item-price" placeholder="0,00" onchange="calculateItemTotals(this)" oninput="calculateItemTotals(this)">
                <select name="item-tax" onchange="calculateItemTotals(this)">
                    <option value="23">23%</option>
                    <option value="8">8%</option>
                    <option value="5">5%</option>
                    <option value="0">0%</option>
                    <option value="zw">zw.</option>
                </select>
                <input type="text" name="item-net-value" readonly placeholder="0,00">
                <input type="text" name="item-gross-value" readonly placeholder="0,00">
                <button class="action-icon-btn remove-item-btn" onclick="removeItem(this)" title="Usuń pozycję">
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <polyline points="3 6 5 6 21 6"></polyline>
                        <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                        <line x1="10" y1="11" x2="10" y2="17"></line>
                        <line x1="14" y1="11" x2="14" y2="17"></line>
                    </svg>
                </button>
            `;
            itemsContainer.appendChild(newItem);
            newItem.classList.add('fadeIn');
            
            // Setup price formatting for the new row
            setupPriceFormatting();
            
            const inputs = newItem.querySelectorAll('input, select');
            inputs.forEach(input => {
                if (input.name === 'item-quantity' || input.name === 'item-price') {
                    input.addEventListener('input', function() {
                        calculateItemTotals(this);
                    });
                }
            });
        });

        function removeItem(button) {
            const row = button.closest('.item-row');
            row.classList.add('fadeOut');
            setTimeout(() => {
                row.remove();
                updateTotals();
            }, 300);
        }
        
        function calculateItemTotals(element) {
            const row = element.closest('.item-row');
            const quantity = parseFloat(row.querySelector('[name="item-quantity"]').value) || 0;
            const priceInput = row.querySelector('[name="item-price"]');
            const priceValue = priceInput.value.replace(/\s/g, '').replace(',', '.'); // Remove spaces and convert comma to dot
            const price = parseFloat(priceValue) || 0;
            const taxRate = row.querySelector('[name="item-tax"]').value;
            const netValue = quantity * price;
            let grossValue = netValue;
            
            if (taxRate !== 'zw') {
                grossValue = netValue * (1 + parseFloat(taxRate) / 100);
            }
            
            // Format with separators for display
            const netValueInput = row.querySelector('[name="item-net-value"]');
            const grossValueInput = row.querySelector('[name="item-gross-value"]');
            
            // Tylko formatuj jeśli jest wartość większa niż 0
            if (netValue > 0) {
                netValueInput.value = formatCurrencyInput(netValue);
                grossValueInput.value = formatCurrencyInput(grossValue);
            } else {
                netValueInput.value = '';
                grossValueInput.value = '';
            }
            
            updateTotals();
        }
        
        function calculateInvoiceTotal() {
            let totalGross = 0;
            document.querySelectorAll('.item-row').forEach((row, index) => {
                if (index === 0) return;
                const grossValueText = row.querySelector('[name="item-gross-value"]').value;
                const grossValue = parseFloat(grossValueText.replace(/\s/g, '').replace(',', '.')) || 0;
                totalGross += grossValue;
            });
            return totalGross;
        }
        
        function updateTotals() {
            let totalNet = 0;
            let totalTax = 0;
            let totalGross = 0;
            const taxRateTotals = {};
            
            document.querySelectorAll('.item-row').forEach((row, index) => {
                if (index === 0) return;
                const netValueText = row.querySelector('[name="item-net-value"]').value;
                const grossValueText = row.querySelector('[name="item-gross-value"]').value;
                const netValue = parseFloat(netValueText.replace(/\s/g, '').replace(',', '.')) || 0;
                const grossValue = parseFloat(grossValueText.replace(/\s/g, '').replace(',', '.')) || 0;
                const taxRate = row.querySelector('[name="item-tax"]').value;
                
                totalNet += netValue;
                totalGross += grossValue;
                const taxAmount = grossValue - netValue;
                totalTax += taxAmount;
                
                if (taxRate !== 'zw') {
                    if (!taxRateTotals[taxRate]) {
                        taxRateTotals[taxRate] = 0;
                    }
                    taxRateTotals[taxRate] += taxAmount;
                }
            });
            
            document.getElementById('total-net').textContent = formatCurrency(totalNet);
            document.getElementById('total-tax').textContent = formatCurrency(totalTax);
            document.getElementById('total-gross').textContent = formatCurrency(totalGross);
            
            // Przebudujemy całą tabelę podsumowania
            const summaryTable = document.getElementById('summary-table');
            
            // Usuwamy wszystkie wiersze poza ostatnim (razem brutto)
            while (summaryTable.rows.length > 1) {
                summaryTable.deleteRow(0);
            }
            
            // Dodajemy wiersz z sumą podatku
            const taxRow = summaryTable.insertRow(0);
            taxRow.innerHTML = `
                <th>Razem podatek VAT:</th>
                <td class="text-right" id="total-tax">${formatCurrency(totalTax)}</td>
            `;
            
            // Dodajemy wiersze ze szczegółami podatku
            Object.keys(taxRateTotals).sort((a, b) => b - a).forEach(rate => {
                if (taxRateTotals[rate] > 0) {
                    const detailRow = summaryTable.insertRow(0);
                    detailRow.innerHTML = `
                        <th>Podatek VAT (${rate}%):</th>
                        <td class="text-right">${formatCurrency(taxRateTotals[rate])}</td>
                    `;
                }
            });
            
            // Dodajemy wiersz z sumą netto na samą górę
            const netRow = summaryTable.insertRow(0);
            netRow.innerHTML = `
                <th>Razem netto:</th>
                <td class="text-right" id="total-net">${formatCurrency(totalNet)}</td>
            `;
            
            // Stylizujemy ostatni wiersz (razem brutto)
            const lastRow = summaryTable.rows[summaryTable.rows.length - 1];
            lastRow.querySelector('th').style.fontSize = '1.1rem';
            lastRow.querySelector('th').style.paddingTop = '1rem';
            lastRow.querySelector('td').style.fontSize = '1.1rem';
            lastRow.querySelector('td').style.fontWeight = '600';
            lastRow.querySelector('td').style.paddingTop = '1rem';
            
            document.getElementById('preview-amount-in-words').textContent = amountInWords(totalGross);
        }
        
        function updatePreviewSummary(taxRateTotals, totalNet, totalTax, totalGross) {
            const previewSummaryTable = document.getElementById('preview-summary-table');
            
            // Przebudowujemy całą tabelę podsumowania w podglądzie
            while (previewSummaryTable.rows.length > 1) {
                previewSummaryTable.deleteRow(0);
            }
            
            // Dodajemy wiersz z sumą podatku
            const taxRow = previewSummaryTable.insertRow(0);
            taxRow.innerHTML = `
                <th style="white-space: nowrap;">Razem VAT:</th>
                <td class="text-right" style="white-space: nowrap;" id="preview-total-tax">${formatCurrency(totalTax)}</td>
            `;
            
            // Dodajemy wiersze ze szczegółami podatku
            Object.keys(taxRateTotals).sort((a, b) => b - a).forEach(rate => {
                if (taxRateTotals[rate] > 0) {
                    const detailRow = previewSummaryTable.insertRow(0);
                    detailRow.innerHTML = `
                        <th style="white-space: nowrap;">Podatek VAT (${rate}%):</th>
                        <td class="text-right" style="white-space: nowrap;">${formatCurrency(taxRateTotals[rate])}</td>
                    `;
                }
            });
            
            // Dodajemy wiersz z sumą netto na samą górę
            const netRow = previewSummaryTable.insertRow(0);
            netRow.innerHTML = `
                <th style="white-space: nowrap;">Razem netto:</th>
                <td class="text-right" style="white-space: nowrap;" id="preview-total-net">${formatCurrency(totalNet)}</td>
            `;
            
            // Stylizujemy ostatni wiersz (razem brutto)
            const lastRow = previewSummaryTable.rows[previewSummaryTable.rows.length - 1];
            lastRow.style.fontWeight = '700';
            
            // Aktualizujemy tekst w polach
            document.getElementById('preview-total-net').textContent = formatCurrency(totalNet);
            document.getElementById('preview-total-tax').text
