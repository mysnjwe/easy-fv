<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SimpleInvoice</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        :root {
            --white: #FFFFFF;
            --light-gray: #F5F5F5;
            --medium-gray: #E0E0E0;
            --dark-gray: #D1D1D1;
            --text-gray: #5A5A5A;
            --accent: #1A2E5A;
            --accent-hover: #122041;
            --success: #34C759;
            --border-radius: 8px;
            --shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
            --transition: all 0.3s ease;
        }

        .dark-mode {
            --white: #1F2A44;
            --light-gray: #2C3857;
            --medium-gray: #374569;
            --dark-gray: #4E5E85;
            --text-gray: #E0E0E0;
            --accent: #3A5899;
            --accent-hover: #4A6AAD;
            --shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--light-gray);
            color: var(--text-gray);
            font-size: 14px;
            transition: var(--transition);
        }

        .container {
            display: flex;
            min-height: 100vh;
        }

        /* Sidebar */
        .sidebar {
            width: 80px;
            background-color: var(--white);
            box-shadow: var(--shadow);
            padding: 20px 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            position: fixed;
            height: 100vh;
            z-index: 10;
            transition: var(--transition);
        }

        .sidebar .logo {
            font-size: 24px;
            font-weight: 700;
            color: var(--accent);
            margin-bottom: 40px;
        }

        .sidebar .nav-item {
            width: 100%;
            display: flex;
            justify-content: center;
            margin-bottom: 20px;
            position: relative;
        }

        .sidebar .nav-item a {
            color: var(--text-gray);
            font-size: 20px;
            padding: 12px;
            border-radius: var(--border-radius);
            transition: var(--transition);
        }

        .sidebar .nav-item a:hover {
            color: var(--accent);
            background-color: var(--light-gray);
            transform: translateY(-2px);
        }

        .sidebar .nav-item a.active {
            color: var(--accent);
        }

        .sidebar .nav-item .tooltip {
            position: absolute;
            left: 80px;
            background-color: var(--white);
            padding: 6px 12px;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            opacity: 0;
            visibility: hidden;
            transition: var(--transition);
            white-space: nowrap;
            font-size: 12px;
            font-weight: 500;
        }

        .sidebar .nav-item:hover .tooltip {
            opacity: 1;
            visibility: visible;
        }

        .sidebar .theme-toggle {
            margin-top: auto;
            padding: 12px;
            border-radius: var(--border-radius);
            cursor: pointer;
            transition: var(--transition);
        }

        .sidebar .theme-toggle:hover {
            background-color: var(--light-gray);
        }

        /* Main Content */
        .main-content {
            flex: 1;
            padding: 20px;
            margin-left: 80px;
            display: flex;
            transition: var(--transition);
        }

        /* Invoice Form */
        .invoice-form {
            flex: 1;
            background-color: var(--white);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            padding: 30px;
            margin-right: 20px;
            max-width: 600px;
            overflow-y: auto;
            max-height: calc(100vh - 40px);
        }

        .invoice-form h1 {
            font-size: 24px;
            margin-bottom: 20px;
            color: var(--accent);
        }

        .form-row {
            margin-bottom: 20px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
        }

        .form-group input, .form-group select, .form-group textarea {
            width: 100%;
            padding: 10px 15px;
            border: 1px solid var(--dark-gray);
            border-radius: var(--border-radius);
            background-color: var(--white);
            color: var(--text-gray);
            transition: var(--transition);
            font-family: 'Inter', sans-serif;
        }

        .form-group input:focus, .form-group select:focus, .form-group textarea:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 2px rgba(26, 46, 90, 0.1);
        }

        .form-row.two-columns {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .section-title {
            font-size: 16px;
            font-weight: 600;
            margin: 25px 0 15px;
            padding-bottom: 5px;
            border-bottom: 1px solid var(--medium-gray);
        }

        /* Items Table */
        .items-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 10px;
        }

        .items-table th {
            text-align: left;
            padding: 8px;
            font-weight: 600;
            border-bottom: 2px solid var(--medium-gray);
        }

        .items-table td {
            padding: 8px;
            border-bottom: 1px solid var(--medium-gray);
        }

        .items-table tr:nth-child(even) {
            background-color: var(--light-gray);
        }

        .items-table input {
            width: 100%;
            padding: 8px;
            border: 1px solid transparent;
            background-color: transparent;
            color: var(--text-gray);
            transition: var(--transition);
        }

        .items-table input:focus {
            outline: none;
            border-color: var(--accent);
            background-color: var(--white);
            box-shadow: 0 0 0 2px rgba(26, 46, 90, 0.1);
        }

        .add-item-btn {
            display: inline-flex;
            align-items: center;
            padding: 8px 15px;
            background-color: var(--white);
            border: 1px solid var(--accent);
            color: var(--accent);
            border-radius: var(--border-radius);
            cursor: pointer;
            transition: var(--transition);
            font-weight: 500;
        }

        .add-item-btn i {
            margin-right: 5px;
        }

        .add-item-btn:hover {
            background-color: var(--light-gray);
        }

        .remove-item-btn {
            background: none;
            border: none;
            color: #ff6b6b;
            cursor: pointer;
            font-size: 16px;
            transition: var(--transition);
        }

        .remove-item-btn:hover {
            color: #ff3e3e;
        }

        /* Totals */
        .totals {
            margin-top: 20px;
            display: flex;
            flex-direction: column;
            align-items: flex-end;
        }

        .total-row {
            display: flex;
            justify-content: space-between;
            width: 250px;
            margin-bottom: 8px;
        }

        .total-row.grand-total {
            font-weight: 600;
            color: var(--accent);
            font-size: 16px;
            border-top: 1px solid var(--medium-gray);
            padding-top: 8px;
        }

        /* Action Buttons */
        .action-buttons {
            display: flex;
            justify-content: flex-end;
            margin-top: 30px;
            gap: 15px;
        }

        button {
            padding: 10px 20px;
            border: none;
            border-radius: var(--border-radius);
            cursor: pointer;
            font-family: 'Inter', sans-serif;
            font-weight: 500;
            transition: var(--transition);
        }

        .btn-primary {
            background-color: var(--accent);
            color: var(--white);
        }

        .btn-primary:hover {
            background-color: var(--accent-hover);
            transform: translateY(-2px);
        }

        .btn-secondary {
            background-color: var(--medium-gray);
            color: var(--text-gray);
        }

        .btn-secondary:hover {
            background-color: var(--dark-gray);
            transform: translateY(-2px);
        }

        /* Invoice Preview */
        .invoice-preview {
            flex: a;
            background-color: var(--white);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            padding: 20px;
            height: calc(100vh - 40px);
            overflow-y: auto;
            position: relative;
        }

        .preview-container {
            background-color: white;
            width: 793px; /* A4 width */
            min-height: 1123px; /* A4 height */
            margin: 0 auto;
            padding: 40px;
            box-shadow: var(--shadow);
            color: black;
        }

        .preview-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 30px;
        }

        .preview-title {
            font-size: 28px;
            color: var(--accent);
            margin-bottom: 5px;
        }

        .preview-info {
            margin-bottom: 30px;
        }

        .preview-info-row {
            display: flex;
            margin-bottom: 5px;
        }

        .preview-info-label {
            width: 150px;
            font-weight: 600;
        }

        .preview-parties {
            display: flex;
            justify-content: space-between;
            margin-bottom: 30px;
        }

        .preview-party {
            width: 48%;
        }

        .preview-party-title {
            font-weight: 600;
            margin-bottom: 5px;
            color: var(--accent);
        }

        .preview-items {
            margin-bottom: 30px;
        }

        .preview-items table {
            width: 100%;
            border-collapse: collapse;
        }

        .preview-items th {
            background-color: var(--accent);
            color: white;
            text-align: left;
            padding: 8px;
        }

        .preview-items td {
            padding: 8px;
            border-bottom: 1px solid var(--medium-gray);
        }

        .preview-items tr:nth-child(even) {
            background-color: var(--light-gray);
        }

        .preview-totals {
            display: flex;
            flex-direction: column;
            align-items: flex-end;
        }

        .preview-total-row {
            display: flex;
            width: 250px;
            justify-content: space-between;
            margin-bottom: 5px;
        }

        .preview-total-row.grand-total {
            font-weight: 600;
            color: var(--accent);
            font-size: 16px;
            border-top: 1px solid var(--medium-gray);
            padding-top: 5px;
        }

        .preview-footer {
            margin-top: 50px;
            font-size: 12px;
            color: var(--text-gray);
            text-align: center;
        }

        /* Toast Notification */
        .toast {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background-color: var(--white);
            color: var(--text-gray);
            padding: 12px 20px;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            display: flex;
            align-items: center;
            transform: translateY(100px);
            opacity: 0;
            transition: var(--transition);
            z-index: 1000;
        }

        .toast.success {
            border-left: 4px solid var(--success);
        }

        .toast.error {
            border-left: 4px solid #ff6b6b;
        }

        .toast.show {
            transform: translateY(0);
            opacity: 1;
        }

        .toast i {
            margin-right: 10px;
            font-size: 18px;
        }

        .toast.success i {
            color: var(--success);
        }

        .toast.error i {
            color: #ff6b6b;
        }

        .toast-message {
            flex: 1;
        }

        .toast-close {
            font-size: 16px;
            cursor: pointer;
            margin-left: 10px;
        }

        /* Media Queries */
        @media (max-width: 1200px) {
            .invoice-preview {
                display: none;
            }
            
            .invoice-form {
                max-width: none;
                margin-right: 0;
            }
            
            .action-buttons {
                justify-content: space-between;
            }
            
            .action-buttons button {
                min-width: 150px;
            }
        }

        @media (max-width: 768px) {
            .sidebar {
                width: 60px;
            }
            
            .main-content {
                margin-left: 60px;
            }
            
            .sidebar .logo {
                font-size: 20px;
            }
            
            .form-row.two-columns {
                grid-template-columns: 1fr;
            }
            
            .totals {
                align-items: flex-start;
            }
            
            .total-row {
                width: 100%;
            }
        }

        @media (max-width: 576px) {
            .sidebar {
                width: 100%;
                height: 60px;
                flex-direction: row;
                padding: 0 20px;
                justify-content: space-between;
                bottom: 0;
                top: auto;
            }
            
            .sidebar .logo {
                margin-bottom: 0;
                display: flex;
                align-items: center;
            }
            
            .sidebar .nav-items {
                display: flex;
                margin-bottom: 0;
            }
            
            .sidebar .nav-item {
                margin-bottom: 0;
                margin-right: 10px;
            }
            
            .sidebar .theme-toggle {
                margin-top: 0;
                display: flex;
                align-items: center;
            }
            
            .main-content {
                margin-left: 0;
                padding-bottom: 80px;
            }
            
            .invoice-form {
                padding: 20px;
            }
            
            .action-buttons {
                flex-direction: column;
                gap: 10px;
            }
            
            .action-buttons button {
                width: 100%;
            }
            
            .toast {
                left: 20px;
                right: 20px;
                max-width: none;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Sidebar -->
        <div class="sidebar">
            <div class="logo">
                <i class="fas fa-file-invoice"></i>
            </div>
            <div class="nav-item">
                <a href="#" class="active">
                    <i class="fas fa-file-invoice"></i>
                </a>
                <span class="tooltip">Faktury</span>
            </div>
            <div class="nav-item">
                <a href="#">
                    <i class="fas fa-users"></i>
                </a>
                <span class="tooltip">Klienci</span>
            </div>
            <div class="nav-item">
                <a href="#">
                    <i class="fas fa-box"></i>
                </a>
                <span class="tooltip">Produkty</span>
            </div>
            <div class="nav-item">
                <a href="#">
                    <i class="fas fa-chart-bar"></i>
                </a>
                <span class="tooltip">Statystyki</span>
            </div>
            <div class="nav-item">
                <a href="#">
                    <i class="fas fa-cog"></i>
                </a>
                <span class="tooltip">Ustawienia</span>
            </div>
            <div class="theme-toggle" id="theme-toggle">
                <i class="fas fa-moon"></i>
            </div>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Invoice Form -->
            <div class="invoice-form">
                <h1>Nowa faktura</h1>
                <div class="form-row two-columns">
                    <div class="form-group">
                        <label for="document-type">Dokument</label>
                        <select id="document-type" class="form-control">
                            <option value="Faktura VAT">Faktura VAT</option>
                            <option value="Faktura proforma">Faktura proforma</option>
                            <option value="Faktura zaliczkowa">Faktura zaliczkowa</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="invoice-number">Numer</label>
                        <input type="text" id="invoice-number" class="form-control" value="FV/001/03/2025">
                    </div>
                </div>
                <div class="form-row two-columns">
                    <div class="form-group">
                        <label for="issue-date">Data wystawienia</label>
                        <input type="date" id="issue-date" class="form-control">
                    </div>
                    <div class="form-group">
                        <label for="sale-date">Data sprzedaży</label>
                        <input type="date" id="sale-date" class="form-control">
                    </div>
                </div>

                <div class="section-title">Sprzedawca</div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="seller-name">Nazwa firmy</label>
                        <input type="text" id="seller-name" class="form-control">
                    </div>
                </div>
                <div class="form-row two-columns">
                    <div class="form-group">
                        <label for="seller-nip">NIP</label>
                        <input type="text" id="seller-nip" class="form-control">
                    </div>
                    <div class="form-group">
                        <label for="seller-address">Adres</label>
                        <input type="text" id="seller-address" class="form-control">
                    </div>
                </div>
                <div class="form-row two-columns">
                    <div class="form-group">
                        <label for="seller-city">Miasto</label>
                        <input type="text" id="seller-city" class="form-control">
                    </div>
                    <div class="form-group">
                        <label for="seller-postal">Kod pocztowy</label>
                        <input type="text" id="seller-postal" class="form-control">
                    </div>
                </div>

                <div class="section-title">Nabywca</div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="buyer-name">Nazwa firmy / Imię i nazwisko</label>
                        <input type="text" id="buyer-name" class="form-control">
                    </div>
                </div>
                <div class="form-row two-columns">
                    <div class="form-group">
                        <label for="buyer-nip">NIP</label>
                        <input type="text" id="buyer-nip" class="form-control">
                    </div>
                    <div class="form-group">
                        <label for="buyer-address">Adres</label>
                        <input type="text" id="buyer-address" class="form-control">
                    </div>
                </div>
                <div class="form-row two-columns">
                    <div class="form-group">
                        <label for="buyer-city">Miasto</label>
                        <input type="text" id="buyer-city" class="form-control">
                    </div>
                    <div class="form-group">
                        <label for="buyer-postal">Kod pocztowy</label>
                        <input type="text" id="buyer-postal" class="form-control">
                    </div>
                </div>

                <div class="section-title">Pozycje faktury</div>
                <table class="items-table" id="items-table">
                    <thead>
                        <tr>
                            <th width="40%">Nazwa towaru/usługi</th>
                            <th width="10%">Ilość</th>
                            <th width="15%">Cena netto</th>
                            <th width="10%">VAT %</th>
                            <th width="15%">Wartość brutto</th>
                            <th width="10%"></th>
                        </tr>
                    </thead>
                    <tbody id="items-body">
                        <tr>
                            <td><input type="text" class="item-name" placeholder="Nazwa pozycji"></td>
                            <td><input type="number" class="item-quantity" value="1" min="1"></td>
                            <td><input type="number" class="item-price" value="0.00" step="0.01"></td>
                            <td><input type="number" class="item-vat" value="23" min="0"></td>
                            <td><input type="number" class="item-total" value="0.00" step="0.01" readonly></td>
                            <td><button class="remove-item-btn"><i class="fas fa-trash"></i></button></td>
                        </tr>
                    </tbody>
                </table>
                <button class="add-item-btn" id="add-item-btn">
                    <i class="fas fa-plus"></i> Dodaj pozycję
                </button>

                <div class="totals">
                    <div class="total-row">
                        <span>Suma netto:</span>
                        <span id="total-net">0.00 PLN</span>
                    </div>
                    <div class="total-row">
                        <span>Suma VAT:</span>
                        <span id="total-vat">0.00 PLN</span>
                    </div>
                    <div class="total-row grand-total">
                        <span>Razem brutto:</span>
                        <span id="total-gross">0.00 PLN</span>
                    </div>
                </div>

                <div class="section-title">Płatność</div>
                <div class="form-row two-columns">
                    <div class="form-group">
                        <label for="payment-method">Sposób płatności</label>
                        <select id="payment-method" class="form-control">
                            <option value="przelew">przelew</option>
                            <option value="gotówka">gotówka</option>
                            <option value="karta">karta płatnicza</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="payment-due-date">Termin płatności</label>
                        <input type="date" id="payment-due-date" class="form-control">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="bank-account">Numer konta bankowego</label>
                        <input type="text" id="bank-account" class="form-control">
                    </div>
                </div>

                <div class="section-title">Uwagi</div>
                <div class="form-row">
                    <div class="form-group">
                        <textarea id="notes" class="form-control" rows="3"></textarea>
                    </div>
                </div>

                <div class="action-buttons">
                    <button class="btn-secondary" id="clear-btn">Wyczyść</button>
                    <button class="btn-primary" id="preview-btn">Podgląd</button>
                    <button class="btn-primary" id="generate-btn">Generuj fakturę</button>
                </div>
            </div>

            <!-- Invoice Preview -->
            <div class="invoice-preview">
                <div class="preview-container" id="invoice-preview-container">
                    <div class="preview-header">
                        <div>
                            <h1 class="preview-title">Faktura VAT</h1>
                            <div>Nr: <span id="preview-invoice-number">FV/001/03/2025</span></div>
                        </div>
                        <div>
                            <div>Data wystawienia: <span id="preview-issue-date">01.03.2025</span></div>
                            <div>Data sprzedaży: <span id="preview-sale-date">01.03.2025</span></div>
                        </div>
                    </div>

                    <div class="preview-parties">
                        <div class="preview-party">
                            <div class="preview-party-title">Sprzedawca:</div>
                            <div id="preview-seller-name">Nazwa firmy</div>
                            <div>NIP: <span id="preview-seller-nip"></span></div>
                            <div id="preview-seller-address"></div>
                            <div><span id="preview-seller-postal"></span> <span id="preview-seller-city"></span></div>
                        </div>
                        <div class="preview-party">
                            <div class="preview-party-title">Nabywca:</div>
                            <div id="preview-buyer-name">Nazwa firmy / Imię i nazwisko</div>
                            <div>NIP: <span id="preview-buyer-nip"></span></div>
                            <div id="preview-buyer-address"></div>
                            <div><span id="preview-buyer-postal"></span> <span id="preview-buyer-city"></span></div>
                        </div>
                    </div>

                    <div class="preview-items">
                        <table>
                            <thead>
                                <tr>
                                    <th>Lp.</th>
                                    <th>Nazwa towaru/usługi</th>
                                    <th>Ilość</th>
                                    <th>Cena netto</th>
                                    <th>VAT %</th>
                                    <th>Wartość netto</th>
                                    <th>Wartość VAT</th>
                                    <th>Wartość brutto</th>
                                </tr>
                            </thead>
                            <tbody id="preview-items-body">
                                <!-- Items will be added dynamically -->
                            </tbody>
                        </table>
                    </div>

                    <div class="preview-totals">
                        <div class="preview-total-row">
                            <span>Suma netto:</span>
                            <span id="preview-total-net">0.00 PLN</span>
                        </div>
                        <div class="preview-total-row">
                            <span>Suma VAT:</span>
                            <span id="preview-total-vat">0.00 PLN</span>
                        </div>
                        <div class="preview-total-row grand-total">
                            <span>Razem brutto:</span>
                            <span id="preview-total-gross">0.00 PLN</span>
                        </div>
                    </div>

                    <div class="preview-info">
                        <div class="preview-info-row">
                            <div class="preview-info-label">Sposób płatności:</div>
                            <div id="preview-payment-method">przelew</div>
                        </div>
                        <div class="preview-info-row">
                            <div class="preview-info-label">Termin płatności:</div>
                            <div id="preview-payment-due-date">15.03.2025</div>
                        </div>
                        <div class="preview-info-row">
                            <div class="preview-info-label">Numer konta:</div>
                            <div id="preview-bank-account"></div>
                        </div>
                    </div>

                    <div class="preview-footer">
                        <div id="preview-notes"></div>
                        <div style="margin-top: 10px;">Dziękujemy za skorzystanie z naszych usług.</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast Notification -->
    <div class="toast" id="toast">
        <i class="fas fa-check-circle"></i>
        <div class="toast-message" id="toast-message"></div>
        <div class="toast-close" id="toast-close">&times;</div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize dates
            const today = new Date();
            const formattedDate = today.toISOString().split('T')[0];
            document.getElementById('issue-date').value = formattedDate;
            document.getElementById('sale-date').value = formattedDate;
            
            // Set due date to +14 days
            const dueDate = new Date(today);
            dueDate.setDate(dueDate.getDate() + 14);
            document.getElementById('payment-due-date').value = dueDate.toISOString().split('T')[0];
            
            // Toggle dark mode
            const themeToggle = document.getElementById('theme-toggle');
            themeToggle.addEventListener('click', function() {
                document.body.classList.toggle('dark-mode');
                const icon = themeToggle.querySelector('i');
                if (document.body.classList.contains('dark-mode')) {
                    icon.classList.remove('fa-moon');
                    icon.classList.add('fa-sun');
                } else {
                    icon.classList.remove('fa-sun');
                    icon.classList.add('fa-moon');
                }
                showToast('success', 'Zmieniono motyw');
            });
            
            // Handle items calculations
            function calculateItemTotal(row) {
                const quantity = parseFloat(row.querySelector('.item-quantity').value) || 0;
                const price = parseFloat(row.querySelector('.item-price').value) || 0;
                const vat = parseFloat(row.querySelector('.item-vat').value) || 0;
                
                const netValue = quantity * price;
                const vatValue = netValue * (vat / 100);
                const grossValue = netValue + vatValue;
                
                row.querySelector('.item-total').value = grossValue.toFixed(2);
                
                updateTotals();
            }
            
            // Add event listeners to calculate item totals
            document.querySelectorAll('#items-body tr').forEach(row => {
                ['item-quantity', 'item-price', 'item-vat'].forEach(className => {
                    row.querySelector(`.${className}`).addEventListener('input', () => calculateItemTotal(row));
                });
            });
            
            // Add new item
            document.getElementById('add-item-btn').addEventListener('click', function() {
                const tbody = document.getElementById('items-body');
                const newRow = document.createElement('tr');
                newRow.innerHTML = `
                    <td><input type="text" class="item-name" placeholder="Nazwa pozycji"></td>
                    <td><input type="number" class="item-quantity" value="1" min="1"></td>
                    <td><input type="number" class="item-price" value="0.00" step="0.01"></td>
                    <td><input type="number" class="item-vat" value="23" min="0"></td>
                    <td><input type="number" class="item-total" value="0.00" step="0.01" readonly></td>
                    <td><button class="remove-item-btn"><i class="fas fa-trash"></i></button></td>
                `;
                tbody.appendChild(newRow);
                
                // Add event listeners to new row
                ['item-quantity', 'item-price', 'item-vat'].forEach(className => {
                    newRow.querySelector(`.${className}`).addEventListener('input', () => calculateItemTotal(newRow));
                });
                
                // Add remove button event listener
                newRow.querySelector('.remove-item-btn').addEventListener('click', function() {
                    newRow.remove();
                    updateTotals();
                    updatePreview();
                });
                
                calculateItemTotal(newRow);
                updatePreview();
            });
            
            // Remove item
            document.querySelectorAll('.remove-item-btn').forEach(button => {
                button.addEventListener('click', function() {
                    const row = this.closest('tr');
                    if (document.querySelectorAll('#items-body tr').length > 1) {
                        row.remove();
                        updateTotals();
                        updatePreview();
                    } else {
                        showToast('error', 'Faktura musi zawierać co najmniej jedną pozycję');
                    }
                });
            });
            
            // Update totals
            function updateTotals() {
                let totalNet = 0;
                let totalVat = 0;
                let totalGross = 0;
                
                document.querySelectorAll('#items-body tr').forEach(row => {
                    const quantity = parseFloat(row.querySelector('.item-quantity').value) || 0;
                    const price = parseFloat(row.querySelector('.item-price').value) || 0;
                    const vat = parseFloat(row.querySelector('.item-vat').value) || 0;
                    
                    const netValue = quantity * price;
                    const vatValue = netValue * (vat / 100);
                    const grossValue = netValue + vatValue;
                    
                    totalNet += netValue;
                    totalVat += vatValue;
                    totalGross += grossValue;
                });
                
                document.getElementById('total-net').textContent = totalNet.toFixed(2) + ' PLN';
                document.getElementById('total-vat').textContent = totalVat.toFixed(2) + ' PLN';
                document.getElementById('total-gross').textContent = totalGross.toFixed(2) + ' PLN';
                
                // Update preview totals as well
                document.getElementById('preview-total-net').textContent = totalNet.toFixed(2) + ' PLN';
                document.getElementById('preview-total-vat').textContent = totalVat.toFixed(2) + ' PLN';
                document.getElementById('preview-total-gross').textContent = totalGross.toFixed(2) + ' PLN';
            }
            
            // Format date for preview
            function formatDate(dateString) {
                if (!dateString) return '';
                const date = new Date(dateString);
                return date.toLocaleDateString('pl-PL');
            }
            
            // Update preview
            function updatePreview() {
                // Update invoice header
                const documentType = document.getElementById('document-type').value;
                document.querySelector('.preview-title').textContent = documentType;
                
                document.getElementById('preview-invoice-number').textContent = document.getElementById('invoice-number').value;
                document.getElementById('preview-issue-date').textContent = formatDate(document.getElementById('issue-date').value);
                document.getElementById('preview-sale-date').textContent = formatDate(document.getElementById('sale-date').value);
                
                // Update seller info
                document.getElementById('preview-seller-name').textContent = document.getElementById('seller-name').value || 'Nazwa firmy';
                document.getElementById('preview-seller-nip').textContent = document.getElementById('seller-nip').value || '';
                document.getElementById('preview-seller-address').textContent = document.getElementById('seller-address').value || '';
                document.getElementById('preview-seller-postal').textContent = document.getElementById('seller-postal').value || '';
                document.getElementById('preview-seller-city').textContent = document.getElementById('seller-city').value || '';
                
                // Update buyer info
                document.getElementById('preview-buyer-name').textContent = document.getElementById('buyer-name').value || 'Nazwa firmy / Imię i nazwisko';
                document.getElementById('preview-buyer-nip').textContent = document.getElementById('buyer-nip').value || '';
                document.getElementById('preview-buyer-address').textContent = document.getElementById('buyer-address').value || '';
                document.getElementById('preview-buyer-postal').textContent = document.getElementById('buyer-postal').value || '';
                document.getElementById('preview-buyer-city').textContent = document.getElementById('buyer-city').value || '';
                
                // Update items
                const previewItemsBody = document.getElementById('preview-items-body');
                previewItemsBody.innerHTML = '';
                
                document.querySelectorAll('#items-body tr').forEach((row, index) => {
                    const name = row.querySelector('.item-name').value || 'Pozycja ' + (index + 1);
                    const quantity = parseFloat(row.querySelector('.item-quantity').value) || 0;
                    const price = parseFloat(row.querySelector('.item-price').value) || 0;
                    const vat = parseFloat(row.querySelector('.item-vat').value) || 0;
                    
                    const netValue = quantity * price;
                    const vatValue = netValue * (vat / 100);
                    const grossValue = netValue + vatValue;
                    
                    const newRow = document.createElement('tr');
                    newRow.innerHTML = `
                        <td>${index + 1}</td>
                        <td>${name}</td>
                        <td>${quantity}</td>
                        <td>${price.toFixed(2)} PLN</td>
                        <td>${vat}%</td>
                        <td>${netValue.toFixed(2)} PLN</td>
                        <td>${vatValue.toFixed(2)} PLN</td>
                        <td>${grossValue.toFixed(2)} PLN</td>
                    `;
                    previewItemsBody.appendChild(newRow);
                });
                
                // Update payment info
                document.getElementById('preview-payment-method').textContent = document.getElementById('payment-method').value;
                document.getElementById('preview-payment-due-date').textContent = formatDate(document.getElementById('payment-due-date').value);
                document.getElementById('preview-bank-account').textContent = document.getElementById('bank-account').value || '';
                
                // Update notes
                document.getElementById('preview-notes').textContent = document.getElementById('notes').value || '';
            }
            
            // Real-time preview updates
            const formInputs = document.querySelectorAll('input, select, textarea');
            formInputs.forEach(input => {
                input.addEventListener('input', updatePreview);
            });
            
            // Initial preview update
            updatePreview();
            
            // Generate invoice (PDF)
            document.getElementById('generate-btn').addEventListener('click', function() {
                // In a real application, you would implement PDF generation here
                // For this demo, we'll just show a toast notification
                showToast('success', 'Faktura została wygenerowana');
            });
            
            // Preview button (show/hide on mobile)
            document.getElementById('preview-btn').addEventListener('click', function() {
                const preview = document.querySelector('.invoice-preview');
                if (window.innerWidth <= 1200) {
                    preview.style.display = preview.style.display === 'block' ? 'none' : 'block';
                    if (preview.style.display === 'block') {
                        updatePreview();
                    }
                }
            });
            
            // Clear form
            document.getElementById('clear-btn').addEventListener('click', function() {
                if (confirm('Czy na pewno chcesz wyczyścić formularz?')) {
                    // Reset form but keep dates
                    const issueDate = document.getElementById('issue-date').value;
                    const saleDate = document.getElementById('sale-date').value;
                    const dueDate = document.getElementById('payment-due-date').value;
                    
                    document.querySelectorAll('input:not([type="date"]), textarea').forEach(input => {
                        input.value = '';
                    });
                    
                    document.getElementById('document-type').value = 'Faktura VAT';
                    document.getElementById('invoice-number').value = 'FV/001/03/2025';
                    document.getElementById('payment-method').value = 'przelew';
                    
                    document.getElementById('issue-date').value = issueDate;
                    document.getElementById('sale-date').value = saleDate;
                    document.getElementById('payment-due-date').value = dueDate;
                    
                    // Reset items
                    const tbody = document.getElementById('items-body');
                    tbody.innerHTML = '';
                    const newRow = document.createElement('tr');
                    newRow.innerHTML = `
                        <td><input type="text" class="item-name" placeholder="Nazwa pozycji"></td>
                        <td><input type="number" class="item-quantity" value="1" min="1"></td>
                        <td><input type="number" class="item-price" value="0.00" step="0.01"></td>
                        <td><input type="number" class="item-vat" value="23" min="0"></td>
                        <td><input type="number" class="item-total" value="0.00" step="0.01" readonly></td>
                        <td><button class="remove-item-btn"><i class="fas fa-trash"></i></button></td>
                    `;
                    tbody.appendChild(newRow);
                    
                    // Add event listeners to new row
                    ['item-quantity', 'item-price', 'item-vat'].forEach(className => {
                        newRow.querySelector(`.${className}`).addEventListener('input', () => calculateItemTotal(newRow));
                    });
                    
                    // Add remove button event listener
                    newRow.querySelector('.remove-item-btn').addEventListener('click', function() {
                        if (document.querySelectorAll('#items-body tr').length > 1) {
                            newRow.remove();
                            updateTotals();
                            updatePreview();
                        } else {
                            showToast('error', 'Faktura musi zawierać co najmniej jedną pozycję');
                        }
                    });
                    
                    updateTotals();
                    updatePreview();
                    showToast('success', 'Formularz został wyczyszczony');
                }
            });
            
            // Toast notification
            const toast = document.getElementById('toast');
            const toastMessage = document.getElementById('toast-message');
            const toastClose = document.getElementById('toast-close');
            
            function showToast(type, message) {
                toast.className = 'toast ' + type + ' show';
                toastMessage.textContent = message;
                
                const icon = toast.querySelector('i');
                icon.className = type === 'success' ? 'fas fa-check-circle' : 'fas fa-exclamation-circle';
                
                setTimeout(() => {
                    toast.className = 'toast ' + type;
                }, 3000);
            }
            
            toastClose.addEventListener('click', function() {
                toast.className = 'toast';
            });
            
            // Responsive adjustments
            window.addEventListener('resize', function() {
                const preview = document.querySelector('.invoice-preview');
                if (window.innerWidth > 1200) {
                    preview.style.display = 'block';
                } else {
                    preview.style.display = 'none';
                }
            });
        });
    </script>
</body>
</html>
